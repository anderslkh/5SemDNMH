@using Models

@{
    ViewData["Title"] = "Upload Images";
}

<form asp-action="UploadAsync" enctype="multipart/form-data">
    <div>
        <label for="File">File:</label>
        <input type="file" name="File" id="File" />
    </div>
    <div>
        <button type="button" onclick="getExifData()">Get Data</button>
    </div>
    <div>
        <label for="Title">Title:</label>
        <input type="text" name="Title" id="Title" />
    </div>
    <div>
        <label for="Description">Description:</label>
        <input type="text" name="Description" id="Description" />
    </div>
    <div>
        <label for="Location">Location:</label>
        <input type="text" name="Location" id="Location" />
    </div>
    <div>
        <label for="CopyrightInformation">Copyright Information:</label>
        <input type="text" name="CopyrightInformation" id="CopyrightInformation" />
    </div>
    <div>
        <label for="Keywords">Keywords (separate with comma):</label>
        <input type="text" name="Keywords" id="Keywords" />
    </div>
    <div>
        <button type="submit">Upload</button>
    </div>
</form>

<script src="https://cdn.jsdelivr.net/npm/exifr/dist/exifr.min.js"></script>
<script>
    function getExifData() {
        const fileInput = document.getElementById('File');
        const file = fileInput.files[0];

        EXIFR.getData(file)
            .then(metadata => {
                document.getElementById('Title').value = metadata.ImageDescription || '';
                document.getElementById('Description').value = metadata.ImageDescription || '';
                document.getElementById('Location').value = metadata.latitude && metadata.longitude ? `Latitude: ${metadata.latitude}, Longitude: ${metadata.longitude}` : '';
                document.getElementById('CopyrightInformation').value = metadata.Copyright || '';
                document.getElementById('Keywords').value = metadata.Keywords ? metadata.Keywords.join(', ') : '';
            })
            .catch(error => {
                console.error('Error extracting EXIF metadata:', error);
            });
    }
</script>
